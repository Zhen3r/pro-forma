---
title: "Predicting rideshare demand in New York City"
author: "Zhenzhao Xu"
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_float: true
editor_options: 
  markdown: 
    wrap: sentence
  chunk_output_type: inline
---

```{r}
knitr::opts_chunk$set(
	message = FALSE,
	warning = FALSE,
	results=FALSE,
	fig.align="center",
	cache=T
)
```

```{r}
library(tidyverse)
library(tidycensus)
library(sf)
library(kableExtra)
library(patchwork)
library(ggplot2)
library(viridis)
library(gridExtra)
library(knitr)

options(scipen=999)
options(tigris_class = "sf")
options(tigris_use_cache = TRUE)
source("functions.r")

p5 = inferno(5)
p2 = p5[c(4,2)]

v = mapview::mapview

# NAD83(2011) / San Francisco CS13
crs = 7131
```


## 1. Introduction

osm amentities
zoning (offstreet parking)
weather
time, space lag
festivals

Map of Parking Regulations https://data.sfgov.org/Transportation/Map-of-Parking-Regulations/qbyz-te2i
SFMTA-Enforced Temporary Tow Zones https://data.sfgov.org/Transportation/SFMTA-Enforced-Temporary-Tow-Zones/9dsr-3f97

SFMTA Managed Off-street Parking

```{r}
meter_trans = read.csv("./data/meter_trans_2021-09.csv")
meter_trans%>%nrow()

meters = st_read("./data/meters.geojson")%>%
  select(post_id, ms_space_num, on_offstreet_type, active_meter_flag, meter_type,
         street_id, street_seg_ctrln_id, longitude, latitude, geometry)%>%
  st_transform(crs)%>%
  mutate(
    street_seg_ctrln_id = street_seg_ctrln_id%>%as.numeric()%>%as.character(),
    ms_space_num = as.numeric(ms_space_num),
    ms_space_num = if_else(ms_space_num==0,1,ms_space_num)
  )

meters%>%filter(street_seg_ctrln_id=="12166000")%>%v()

meters.bySegId = meters%>%st_drop_geometry()%>%
  group_by(street_seg_ctrln_id,on_offstreet_type)%>%
  summarise(ms_space_num = n())%>%
  filter(on_offstreet_type=="ON")

meters.bySegId%>%
  left_join(parking_seg_census,by="street_seg_ctrln_id")%>%view()
  ggplot()+
  geom_point(aes(ms_space_num,PRKG_SPLY))+
  geom_abline(intercept = 0, slope = 1,color="red")
```






















